<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cadastro de Motorista</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #F4F6FA;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    .container {
      width: 100%;
      max-width: 600px;
      background-color: #fff;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1, h2 {
      text-align: center;
      color: #000;
      margin-bottom: 20px;
    }

    form {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    label {
      align-self: flex-start;
      margin-top: 20px;
      font-weight: 600;
      color: #333;
    }

    input, select {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
    }

    button {
      width: 100%;
      padding: 14px;
      margin-top: 30px;
      border-radius: 8px;
      border: none;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      opacity: 0.9;
    }

    #botaoCadastrar {
      background-color: #FFD600;
    }

    #botaoFirebase {
      background-color: #4CAF50;
      color: white;
    }

    #mensagemCadastro, #contadorMotoristas {
      margin-top: 20px;
      font-weight: bold;
      text-align: center;
      color: #000;
    }

    #contadorMotoristas {
      font-size: 14px;
      color: #555;
    }
  </style>
</head>
<body>
  <main class="container">
    <h1>üìù Cadastro de Motorista</h1>

    <label for="seletorMotorista">Escolha o motorista para enviar ao Firebase:</label>
    <select id="seletorMotorista">
      <option value="">Selecione um ID</option>
    </select>

    <button type="button" id="botaoFirebase">‚úÖ Salvar motorista selecionado no Firebase</button>

    <form id="formMotorista">
      <label for="nome">Nome completo:</label>
      <input type="text" id="nome" required />

      <label for="telefone">Telefone (WhatsApp):</label>
      <input type="tel" id="telefone" required />

      <h2>üöó Dados do Ve√≠culo</h2>

      <label for="marca">Marca:</label>
      <input type="text" id="marca" required />

      <label for="modelo">Modelo:</label>
      <input type="text" id="modelo" required />

      <label for="cor">Cor do ve√≠culo:</label>
      <input type="text" id="cor" required />

      <label for="tipoCarro">Tipo de carro:</label>
      <select id="tipoCarro" required>
        <option value="">Selecione</option>
        <option value="Hatch">Hatch</option>
        <option value="Sedan">Sedan</option>
        <option value="SUV">SUV</option>
        <option value="Picape">Picape</option>
        <option value="Van">Van</option>
      </select>

      <label for="ano">Ano:</label>
      <input type="number" id="ano" min="2000" max="2025" required />

      <label for="tipoPlaca">Tipo de Placa:</label>
      <select id="tipoPlaca" required>
        <option value="mercosul">Mercosul</option>
        <option value="antiga">Antiga</option>
      </select>

      <label for="placa">Placa:</label>
      <input type="text" id="placa" maxlength="8" required />

      <label for="senha">Senha de acesso (5 d√≠gitos):</label>
      <div style="position: relative; width: 100%;">
        <input
          type="password"
          id="senha"
          pattern="\d{5}"
          maxlength="5"
          required
          style="width: 100%; padding: 12px 40px 12px 12px; margin-top: 8px; border-radius: 8px; border: 1px solid #ccc; font-size: 15px; box-sizing: border-box;"
        />
        <span onclick="toggleSenha()" style="
          position: absolute;
          right: 12px;
          top: 50%;
          transform: translateY(-50%);
          cursor: pointer;
          font-size: 18px;
          color: #888;
        ">üëÅÔ∏è</span>
      </div>

      <button type="submit" id="botaoCadastrar">Cadastrar Motorista</button>
    </form>

    <div id="mensagemCadastro"></div>
    <div id="contadorMotoristas"></div>
  </main>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDZKV7Gpy1VCSMxVW__w3PDCyepwJ7Vv6c",
      authDomain: "viasimples-9d340.firebaseapp.com",
      projectId: "viasimples-9d340",
      storageBucket: "viasimples-9d340.appspot.com",
      messagingSenderId: "372389283187",
      appId: "1:372389283187:web:139f81f5224bb0958e7106"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const form = document.getElementById("formMotorista");
    const mensagem = document.getElementById("mensagemCadastro");
    const contador = document.getElementById("contadorMotoristas");
    const seletor = document.getElementById("seletorMotorista");
    const botaoFirebase = document.getElementById("botaoFirebase");

    function toggleSenha() {
      const campo = document.getElementById("senha");
      campo.type = campo.type === "password" ? "text" : "password";
    }

    function capitalizarTexto(texto) {
      return texto
        .toLowerCase()
        .split(" ")
        .map(p => p.charAt(0).toUpperCase() + p.slice(1))
        .join(" ");
    }

    function formatarTelefone(valor) {
      valor = valor.replace(/\D/g, "");
      if (valor.length === 10) {
        return valor.replace(/(\d{2})(\d{4})(\d{4})/, "($1) $2-$3");
      } else if (valor.length === 11) {
        return valor.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
      }
      return valor;
    }

    function formatarPlaca(valor) {
      valor = valor.toUpperCase().replace(/[^A-Z0-9]/g, "");
      if (valor.length >= 7) {
        return valor.slice(0, 3) + '-' + valor.slice(3, 7);
      }
      return valor;
    }

    function gerarIdUnico() {
      const lista = JSON.parse(localStorage.getItem("motoristas") || "[]");
      let novoId = 1;
      const idsExistentes = lista.map(m => parseInt(m.id));
      while (idsExistentes.includes(novoId)) {
        novoId++;
      }
      return String(novoId).padStart(3, '0');
    }

    function limparFormulario() {
      form.reset();
    }

    function atualizarContador() {
      const lista = JSON.parse(localStorage.getItem("motoristas") || "[]");
      contador.innerText = `Total de motoristas cadastrados: ${lista.length}`;
    }

        function atualizarSeletor() {
      const lista = JSON.parse(localStorage.getItem("motoristas") || "[]");
      seletor.innerHTML = '<option value="">Selecione um ID</option>';
      lista.forEach(m => {
        const option = document.createElement("option");
        option.value = m.id;
        option.textContent = `${m.nome} (ID: ${m.id})`;
        seletor.appendChild(option);
      });
    }

    // Eventos de formata√ß√£o autom√°tica
    ["nome", "marca", "modelo", "cor"].forEach(id => {
      document.getElementById(id).addEventListener("blur", e => {
        e.target.value = capitalizarTexto(e.target.value);
      });
    });

    document.getElementById("telefone").addEventListener("blur", e => {
      e.target.value = formatarTelefone(e.target.value);
    });

    document.getElementById("placa").addEventListener("blur", e => {
      e.target.value = formatarPlaca(e.target.value);
    });

    // Cadastro de motorista
    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const motorista = {
        id: gerarIdUnico(),
        nome: document.getElementById("nome").value.trim(),
        telefone: document.getElementById("telefone").value.trim(),
        marca: document.getElementById("marca").value.trim(),
        modelo: document.getElementById("modelo").value.trim(),
        cor: document.getElementById("cor").value.trim(),
        "Tipo de carro": document.getElementById("tipoCarro").value,
        ano: document.getElementById("ano").value.trim(),
        tipoPlaca: document.getElementById("tipoPlaca").value,
        placa: document.getElementById("placa").value.trim().toUpperCase(),
        senha: document.getElementById("senha").value.trim(),
        ativo: true
      };

      const lista = JSON.parse(localStorage.getItem("motoristas") || "[]");
      lista.push(motorista);
      localStorage.setItem("motoristas", JSON.stringify(lista));

      mensagem.innerText = `‚úÖ Motorista ${motorista.nome} cadastrado com sucesso! (ID: ${motorista.id})`;
      atualizarContador();
      atualizarSeletor();
      limparFormulario();
    });

    // Envio ao Firebase do motorista selecionado
    botaoFirebase.addEventListener("click", async () => {
      const idSelecionado = seletor.value;
      if (!idSelecionado) {
        alert("‚ö†Ô∏è Selecione um motorista para enviar.");
        return;
      }

      const lista = JSON.parse(localStorage.getItem("motoristas") || "[]");
      const motorista = lista.find(m => m.id === idSelecionado);

      if (!motorista) {
        alert("‚ùå Motorista n√£o encontrado.");
        return;
      }

      try {
        await db.collection("motoristas").doc(motorista.id).set(motorista);
        alert(`üöÄ Motorista ${motorista.nome} enviado ao Firebase com sucesso!`);
      } catch (error) {
        console.error("Erro ao salvar no Firebase:", error);
        alert("‚ùå Erro ao salvar no Firebase.");
      }
    });

    // Inicializa√ß√£o
    atualizarContador();
    atualizarSeletor();
  </script>
</body>
</html>
