<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cadastro de Motorista</title>

  <!-- Verifica√ß√£o de acesso -->
  <script>
    const usuario = localStorage.getItem("usuario");
    if (usuario !== "admin") {
      window.location.href = "login.html";
    }
  </script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #F4F6FA;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    .container {
      width: 100%;
      max-width: 600px;
      background-color: #fff;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1, h2 {
      text-align: center;
      color: #000;
      margin-bottom: 20px;
    }

    form {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    label {
      align-self: flex-start;
      margin-top: 20px;
      font-weight: 600;
      color: #333;
    }

    input, select {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
    }

    button {
      width: 100%;
      padding: 14px;
      margin-top: 30px;
      border-radius: 8px;
      border: none;
      background-color: #FFD600;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background-color: #FFC400;
    }

    #mensagemCadastro, #contadorMotoristas {
      margin-top: 20px;
      font-weight: bold;
      text-align: center;
      color: #000;
    }

    #contadorMotoristas {
      font-size: 14px;
      color: #555;
    }

    #botaoFirebase {
      background-color: #4CAF50;
      color: white;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <main class="container">
    <h1>üìù Cadastro de Motorista</h1>

    <button type="button" id="botaoFirebase">‚úÖ Salvar no Firebase</button>

    <form id="formMotorista">
      <label for="nome">Nome completo:</label>
      <input type="text" id="nome" required />

      <label for="telefone">Telefone (WhatsApp):</label>
      <input type="tel" id="telefone" required />

      <h2>üöó Dados do Ve√≠culo</h2>

      <label for="marca">Marca:</label>
      <input type="text" id="marca" required />

      <label for="modelo">Modelo:</label>
      <input type="text" id="modelo" required />

      <label for="cor">Cor do ve√≠culo:</label>
      <input type="text" id="cor" required />

      <label for="tipoCarro">Tipo de carro:</label>
      <select id="tipoCarro" required>
        <option value="">Selecione</option>
        <option value="Hatch">Hatch</option>
        <option value="Sedan">Sedan</option>
        <option value="SUV">SUV</option>
        <option value="Picape">Picape</option>
        <option value="Van">Van</option>
      </select>

      <label for="ano">Ano:</label>
      <input type="number" id="ano" min="2000" max="2025" required />

      <label for="tipoPlaca">Tipo de Placa:</label>
      <select id="tipoPlaca" required>
        <option value="mercosul">Mercosul</option>
        <option value="antiga">Antiga</option>
      </select>

      <label for="placa">Placa:</label>
      <input type="text" id="placa" maxlength="8" required />

      <button type="submit">Cadastrar Motorista</button>
    </form>

    <div id="mensagemCadastro"></div>
    <div id="contadorMotoristas"></div>
  </main>

  <!-- Firebase compat√≠vel com navegador -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDZKV7Gpy1VCSMxVW__w3PDCyepwJ7Vv6c",
      authDomain: "viasimples-9d340.firebaseapp.com",
      projectId: "viasimples-9d340",
      storageBucket: "viasimples-9d340.appspot.com",
      messagingSenderId: "372389283187",
      appId: "1:372389283187:web:139f81f5224bb0958e7106"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <!-- Script principal -->
  <script>
    const form = document.getElementById("formMotorista");
    const mensagem = document.getElementById("mensagemCadastro");
    const contador = document.getElementById("contadorMotoristas");

    function capitalizarTexto(texto) {
      return texto.toLowerCase().split(" ").map(p => p.charAt(0).toUpperCase() + p.slice(1)).join(" ");
    }

    function formatarTelefone(valor) {
      valor = valor.replace(/\D/g, "");
      if (valor.length === 11) {
        return valor.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
      }
      return valor;
    }

    function formatarPlaca(valor) {
      valor = valor.toUpperCase().replace(/[^A-Z0-9]/g, "");
      if (valor.length >= 7) {
        return valor.slice(0, 3) + '-' + valor.slice(3, 7);
      }
      return valor;
    }

    function limparFormulario() {
      form.reset();
    }

    function atualizarContador() {
      const lista = JSON.parse(localStorage.getItem("motoristas") || "[]");
      contador.innerText = `Total de motoristas cadastrados: ${lista.length}`;
    }

    function gerarIdSequencial() {
      const lista = JSON.parse(localStorage.getItem("motoristas") || "[]");
      return String(lista.length + 1);
    }

    ["nome", "marca", "modelo", "cor"].forEach(id => {
      document.getElementById(id).addEventListener("blur", e => {
        e.target.value = capitalizarTexto(e.target.value);
      });
    });

    document.getElementById("telefone").addEventListener("blur", e => {
      e.target.value = formatarTelefone(e.target.value);
    });

    document.getElementById("placa").addEventListener("blur", e => {
      e.target.value = formatarPlaca(e.target.value);
    });

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const motorista = {
        id: gerarIdSequencial(),
        nome: document.getElementById("nome").value.trim(),
        telefone: document.getElementById("telefone").value.trim(),
        marca: document.getElementById("marca").value.trim(),
        modelo: document.getElementById("modelo").value.trim(),
        cor: document.getElementById("cor").value.trim(),
        "Tipo de carro": document.getElementById("tipoCarro").value,
        ano: document.getElementById("ano").value.trim(),
        tipoPlaca: document.getElementById("tipoPlaca").value,
        placa: document.getElementById("placa").value.trim().toUpperCase(),
        ativo: true
      };

      const lista = JSON.parse(localStorage.getItem("motoristas") || "[]");
      lista.push(motorista);
      localStorage.setItem("motoristas", JSON.stringify(lista));

            mensagem.innerText = `‚úÖ Motorista ${motorista.nome} cadastrado com sucesso! (ID: ${motorista.id})`;
      atualizarContador();
      limparFormulario();
    });

    document.getElementById("botaoFirebase").addEventListener("click", async () => {
      const lista = JSON.parse(localStorage.getItem("motoristas") || "[]");

      if (lista.length === 0) {
        alert("‚ö†Ô∏è Nenhum motorista encontrado no localStorage.");
        return;
      }

      let sucesso = 0;
      let falhas = 0;

      for (const motorista of lista) {
        try {
          await db.collection("motoristas").add(motorista);
          sucesso++;
        } catch (error) {
          console.error("Erro ao salvar no Firebase:", error);
          falhas++;
        }
      }

      alert(`‚úÖ ${sucesso} motoristas salvos no Firebase.\n‚ùå ${falhas} falhas.`);
    });

    atualizarContador();
  </script>
</body>
</html>
