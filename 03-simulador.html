<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulador de Corrida - ViaSimples</title>
  <link rel="stylesheet" href="style-viasimples.css?v=1.0.1" />
</head>

<body>
  <main class="container">
    <h1>Simule sua corrida</h1>

    <form id="formSimulador" onsubmit="event.preventDefault(); calcularCorrida();" novalidate>
      <label for="nomePassageiro">ğŸ‘¤ Seu nome completo:</label>
      <input type="text" id="nomePassageiro" name="nomePassageiro" required autocomplete="name" placeholder="Ex: Wagner Oliveira" />

      <label for="origem">ğŸ“ Local de partida:</label>
      <input type="text" id="origem" name="origem" autocomplete="off" placeholder="Digite ou use localizaÃ§Ã£o atual" />

      <label for="destino">ğŸ¯ Destino final:</label>
      <input type="text" id="destino" name="destino" required autocomplete="off" placeholder="Ex: Av. Paulista, SÃ£o Paulo" />

      <div class="invisivel">
        <label for="campoTaxaMinima">Taxa mÃ­nima (R$):</label>
        <input type="number" id="campoTaxaMinima" name="campoTaxaMinima" autocomplete="off" readonly />

        <label for="campoValorPorKm">Valor por km (R$):</label>
        <input type="number" id="campoValorPorKm" name="campoValorPorKm" autocomplete="off" readonly />
      </div>

      <div class="botoes">
        <button type="button" onclick="usarLocalizacao()">ğŸ“ Usar localizaÃ§Ã£o atual</button>
        <button type="submit">ğŸš— Calcular corrida</button>
        <button type="button" id="botaoSolicitar" style="display:none;" onclick="solicitarCorrida()">âœ… Solicitar corrida</button>
        <button type="button" id="botaoLimpar" style="display:none;" onclick="limparCampos()">ğŸ§¹ Limpar campos</button>
      </div>

      <div class="botoes">
        <button type="button" id="botaoCancelar" style="display:none;" onclick="cancelarCorrida()">âŒ Cancelar corrida</button>
        <button type="button" id="botaoFinalizar" style="display:none;" onclick="finalizarCorrida()">âœ… Finalizar corrida</button>
      </div>
    </form>

    <div id="mapaGoogle"></div>
    <div id="resultadoCorrida" role="region" aria-live="polite"></div>
    <section id="listaMotoristas" aria-label="Escolha de motorista"></section>
  </main>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDZKV7Gpy1VCSMxVW__w3PDCyepwJ7Vv6c",
      authDomain: "viasimples-9d340.firebaseapp.com",
      projectId: "viasimples-9d340",
      storageBucket: "viasimples-9d340.appspot.com",
      messagingSenderId: "372389283187",
      appId: "1:372389283187:web:139f81f5224bb0958e7106"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Busca os valores atualizados da configuraÃ§Ã£o no Firebase
    async function carregarConfiguracao() {
      try {
        const doc = await db.collection("configuracao").doc("valores").get();
        if (doc.exists) {
          const dados = doc.data();
          document.getElementById("campoTaxaMinima").value = dados.taxaMinima || 0;
          document.getElementById("campoValorPorKm").value = dados.valorPorKm || 0;
        } else {
          console.warn("Documento de configuraÃ§Ã£o nÃ£o encontrado.");
        }
      } catch (error) {
        console.error("Erro ao carregar configuraÃ§Ã£o:", error);
      }
    }

    // FunÃ§Ã£o para usar localizaÃ§Ã£o atual
    function usarLocalizacao() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (posicao) => {
            const { latitude, longitude } = posicao.coords;
            document.getElementById("origem").value = `Lat: ${latitude.toFixed(5)}, Lng: ${longitude.toFixed(5)}`;
          },
          (erro) => {
            alert("NÃ£o foi possÃ­vel obter sua localizaÃ§Ã£o.");
            console.error("Erro de geolocalizaÃ§Ã£o:", erro);
          }
        );
      } else {
        alert("GeolocalizaÃ§Ã£o nÃ£o Ã© suportada neste navegador.");
      }
    }

    // Inicializa o mapa
    function initMap() {
      const mapa = new google.maps.Map(document.getElementById("mapaGoogle"), {
        center: { lat: -23.5505, lng: -46.6333 },
        zoom: 13,
      });
    }
    window.initMap = initMap;

    // Carrega configuraÃ§Ã£o ao abrir
    window.addEventListener("DOMContentLoaded", carregarConfiguracao);
  </script>

  <!-- Script principal do simulador -->
  <script src="03-simulador-script.js" defer></script>

  <!-- Google Maps API com boas prÃ¡ticas -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCVB5urWdkPwjezcC6aMAPOZft9oZMyaUQ&libraries=places&callback=initMap&loading=async" async defer></script>
</body>
</html>
